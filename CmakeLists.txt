cmake_minimum_required(VERSION 3.16)

# Set the project name and version
project(PacificRenderer VERSION 1.0.0)

# Set C++ standard
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

add_executable(${PROJECT_NAME} 
    "src/main.cpp"
    # Add other source files here
    "src/core/Scene.cpp"
    "src/core/Primitives.cpp"
)

target_include_directories(${PROJECT_NAME} PRIVATE 
    ${CMAKE_CURRENT_SOURCE_DIR}/src
)

# Set output directory for binaries
set_target_properties(${PROJECT_NAME} PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin
)

# Set the desired precision
option(DOUBLE_FLOAT "Use double precision floating point" OFF)
if(DOUBLE_FLOAT)
    target_compile_definitions(${PROJECT_NAME} PRIVATE DOUBLE_FLOAT)
endif()

set(BUILD_SHARED_LIBS OFF)

###########################################################################
# zlib

# Disable zlib testing and examples
set(ZLIB_BUILD_TESTING OFF CACHE BOOL " " FORCE)
set(ZLIB_BUILD_SHARED OFF CACHE BOOL " " FORCE)
set(ZLIB_INSTALL OFF CACHE BOOL " " FORCE)

add_subdirectory(ext/zlib)
target_include_directories(${PROJECT_NAME} PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}/ext/zlib
    ${CMAKE_CURRENT_BINARY_DIR}/ext/zlib)   # Is this necessary???
target_link_libraries(${PROJECT_NAME} PRIVATE zlibstatic)
###########################################################################

###########################################################################
# pugixml

add_library(pugixml STATIC ext/pugixml/src/pugixml.cpp)
# Add include directory to the library itself
target_include_directories(pugixml PUBLIC 
    ${CMAKE_CURRENT_SOURCE_DIR}/ext/pugixml/src)
target_link_libraries(${PROJECT_NAME} PRIVATE pugixml)
###########################################################################
# nanogui
# TODO: needs fixing and cleaning

# Disable building extras we won't need (pure C++ project)
set(NANOGUI_BUILD_EXAMPLES OFF CACHE BOOL " " FORCE)
set(NANOGUI_BUILD_PYTHON   OFF CACHE BOOL " " FORCE)
set(NANOGUI_INSTALL        OFF CACHE BOOL " " FORCE)
# Add the configurations from nanogui
add_subdirectory(ext/nanogui)
# For reliability of parallel build, make the NanoGUI targets dependencies
set_property(TARGET glfw glfw_objects nanogui PROPERTY FOLDER "dependencies")
# Various preprocessor definitions have been generated by NanoGUI
# add_definitions(${NANOGUI_EXTRA_DEFS})
target_compile_definitions(${PROJECT_NAME} PRIVATE ${NANOGUI_EXTRA_DEFS})
# On top of adding the path to nanogui/include, you may need extras
target_include_directories( ${PROJECT_NAME} PRIVATE
    ${NANOGUI_EXTRA_INCS})
# Lastly, additional libraries may have been built for you.  In addition to linking
# against NanoGUI, we need to link against those as well.
target_link_libraries(${PROJECT_NAME} PRIVATE nanogui ${NANOGUI_EXTRA_LIBS})
###########################################################################

###########################################################################
# GLM

add_subdirectory(ext/glm)

target_link_libraries(${PROJECT_NAME} PRIVATE glm::glm)
###########################################################################

###########################################################################
# CLI11

add_subdirectory(ext/CLI11)

target_link_libraries(${PROJECT_NAME} PRIVATE CLI11::CLI11)
###########################################################################

###########################################################################
# tinyobjloader

if (DOUBLE_FLOAT)
    set(TINYOBJLOADER_USE_DOUBLE ON CACHE BOOL " " FORCE)
endif()

add_subdirectory(ext/tinyobjloader)

target_link_libraries(${PROJECT_NAME} PRIVATE tinyobjloader)
###########################################################################
